<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/content.css" />
    <script type="text/javascript">
        function add() {}
        var nowRows = document.getElementById("mytable").rows;
        var rows1 = nowRows.length - 1;
        var table1 = document.getElementById("mytable").insertRow(rows1);
        var btn = document.getElementById("myBtn");
        var modal = document.getElementById('myModal');
        var span = document.querySelector('.close');


        // 点击按钮打开弹窗
        btn.onclick = function() {
            modal.style.display = "block";
        }

        // 点击 <span> (x), 关闭弹窗
        span.onclick = function() {
            modal.style.display = "none";
        }



        // 在用户点击其他地方时，关闭弹窗
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }

            /*
            var addRow1=table1.insertCell(0);
            addRow1.innerHTML="<input style='width:100px' type='text' id='Num"+rows1+"' value='输入序号' />";
            
            var addRow2=table1.insertCell(1);
            addRow2.innerHTML="<input style='width:100px' type='text' id='id"+rows1+"' value='输入字段' />";
            
            var addRow2=table1.insertCell(2);
            addRow2.innerHTML="<input style='width:100px' type='text' id='password"+rows1+"' value='输入密码' />";
            
            var addRow2=table1.insertCell(3);
            addRow2.innerHTML="<input style='width:100px' type='text' id='name"+rows1+"' value='输入姓名' />";
            
            var addRow2=table1.insertCell(4);
            addRow2.innerHTML="<input style='width:100px' type='text' id='sex"+rows1+"' value='输入性别' />";
            
            var addRow2=table1.insertCell(5);
            addRow2.innerHTML="<input style='width:100px' type='text' id='years"+rows1+"' value='输入年龄' />";
            
            var addRow2=table1.insertCell(6);
            addRow2.innerHTML="<input style='width:100px' type='text' id='loc"+rows1+"' value='输入地址' />";
            
            var addRow2=table1.insertCell(7);
            addRow2.innerHTML="<input style='width:100px' type='text' id='conne"+rows1+"' value='输入联系方式' />";
            
            var addRow1=table1.insertCell(8);
            addRow1.innerHTML="<input type='button' value='删除' onclick='del(this)'/><input type='button' value='确定' onclick='sure(this)'/><input type='button' value='锁定' onclick='lock(this)'/><input type='button' value='解锁' onclick='unlock(this)'/>";
            */
        }

        function del(tt) {
            var table2 = document.getElementById("mytable");
            var text = tt.parentNode.parentNode.children[0].textContent;
            var url = "http://nightmorning.site:23080/kelvin/user/delete?userId=" + text;


            $.ajaxSetup({
                async: true,
                contentType: "application/json"
            });

            var jqxhr = $.get(url, function(data, status) {
                console.log(data);
                get_search();
            });
        }

        function sure(su) {
            var table4 = document.getElementById("mytable").rows;
            var rowss = su.parentNode.parentNode.rowIndex;

            var cellss = table4[rowss].cells[7];
            cellss.innerHTML = document.getElementById("conne" + rowss).value;

            var cellss = table4[rowss].cells[6];
            cellss.innerHTML = document.getElementById("loc" + rowss).value;

            var cellss = table4[rowss].cells[5];
            cellss.innerHTML = document.getElementById("years" + rowss).value;

            var cellss = table4[rowss].cells[4];
            cellss.innerHTML = document.getElementById("sex" + rowss).value;

            var cellss = table4[rowss].cells[3];
            cellss.innerHTML = document.getElementById("name" + rowss).value;

            var cellss = table4[rowss].cells[2];
            cellss.innerHTML = document.getElementById("password" + rowss).value;

            var cellss = table4[rowss].cells[1];
            cellss.innerHTML = document.getElementById("id" + rowss).value;

            var cellss2 = table4[rowss].cells[0];
            cellss2.innerHTML = document.getElementById("Num" + rowss).value;

            var tableCell1 = su.parentNode;
            tableCell1.innerHTML = "<input type='button' value='删除' onclick='del(this)'/><input type='button' value='修改' onclick='change(this)'/><input type='button' value='锁定' onclick='lock(this)'/><input type='button' value='解锁' onclick='unlock(this)'/>";
        }

        function change(ch) {
            var table3 = document.getElementById("mytable").rows;
            var rowss = ch.parentNode.parentNode.rowIndex;

            var cellss2 = table3[rowss].cells[7];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='conne" + rowss + "' value='' />";
            document.getElementById("conne" + rowss).value = oldR2;

            var cellss2 = table3[rowss].cells[6];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='loc" + rowss + "' value='' />";
            document.getElementById("loc" + rowss).value = oldR2;

            var cellss2 = table3[rowss].cells[5];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='years" + rowss + "' value='' />";
            document.getElementById("years" + rowss).value = oldR2;

            var cellss2 = table3[rowss].cells[4];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='sex" + rowss + "' value='' />";
            document.getElementById("sex" + rowss).value = oldR2;

            var cellss2 = table3[rowss].cells[3];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='name" + rowss + "' value='' />";
            document.getElementById("name" + rowss).value = oldR2;


            var cellss2 = table3[rowss].cells[2];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='password" + rowss + "' value='' />";
            document.getElementById("password" + rowss).value = oldR2;

            var cellss = table3[rowss].cells[1];
            var oldR = cellss.innerHTML;
            cellss.innerHTML = "<input type='text' id='id" + rowss + "' value='' />";
            document.getElementById("id" + rowss).value = oldR;

            var cellss2 = table3[rowss].cells[0];
            var oldR2 = cellss2.innerHTML;
            cellss2.innerHTML = "<input type='text' id='Num" + rowss + "' value='' />";
            document.getElementById("Num" + rowss).value = oldR2;

            var tableCell1 = ch.parentNode;
            tableCell1.innerHTML = "<input type='button' value='删除' onclick='del(this)'/><input type='button' value='确定' onclick='sure(this)' /><input type='button' value='锁定' onclick='lock(this)'/><input type='button' value='解锁' onclick='unlock(this)'/>";
        }

        function lock() {

        }

        function unlock() {

        }
    </script>
    <script type="text/javascript" src="../js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="../js/menu.js"></script>
</head>

<body marginwidth="0" marginheight="0">
    <div class="container">
        <div class="public-nav">您当前的位置：<a href="">管理首页</a>><a href="">用户管理</a></div>
        <div class="public-content">
            <div class="public-content-header">
                <span>
                    <!--修改用户信息<input id="myBtn" type="button" value="增加用户" / onclick="add()">-->
                    用户信息
                    <!--<button id="myBtn">增加用户/button>-->
                    <button type="button" class="submit_button" name="Submit">
                        <a href="add_user.html" style="">
                            增加用户
                        </a>
                    </button>
                </span>
            </div>

            <!-- 弹窗 -->
            <div id="myModal" class="modal" style="display: none;">

                <!-- 弹窗内容 -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <p align="center" id="info">
                        开通新店铺</br>
                        店铺名称：<input type="text" id="username"></br>
                        店铺地址：<input type="text" id="email"></br>
                        联系方式：<input type="text" id="age">
                    </p>
                    <div align="center"><input type="button" id="add" value="添加" onclick="addRow()"></div>
                </div>
            </div>
            <div class="public-content-cont">
                <div style="float: left;">
                    <INPUT placeholder="查找..." id="input" NAME="user_pass" TYPE="text" style="font-size: 14px;" οnmοuseοver="this.style.borderColor='black';this.style.backgroundColor='plum'" style="width: 106; height: 21" οnmοuseοut="this.style.borderColor='black';this.style.backgroundColor='#ffffff'" style="border-width:1px;border-color=black">
                    <input type="button" value="搜索" / onclick="get_search()" style="font-size: 14px;">
                </div>
                <br />
                <br />
                <br />
                <table id="mytable" class="public-cont-table">
                    <tr>
                        <th style="width:5%">序号</th>
                        <th style="width:10%">用户账号</th>
                        <th style="width:10%">姓名</th>
                        <th style="width:5%">性别</th>
                        <th style="width:15%">注册日期</th>
                        <th style="width:10%">电话</th>
                        <th style="width:15%">邮箱</th>
                        <th style="width:25%">操作</th>

                    </tr>
                </table>
                <div class="page">
                    <form action="" method="get">
                        共<span>42</span>个站点
                        <a href="">首页</a>
                        <a href="">上一页</a>
                        <a href="">下一页</a>
                        第<span style="color:red;font-weight:600">12</span>页
                        共<span style="color:red;font-weight:600">120</span>页
                        <input type="text" class="page-input">
                        <input type="submit" class="page-btn" value="跳转">
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    function get_user_list(keywords) {
        $(".tables").remove();
        var url = "http://nightmorning.site:23080/kelvin/user/search";
        var jsondata = {
            "userAccount": keywords
        }

        jd = JSON.stringify(jsondata);
        console.log(jd);

        $.ajaxSetup({
            async: true,
            contentType: "application/json"
        });

        var jqxhr = $.post(url, jd, function(data, status) {
            console.log(data);
            var text;
            for (var i = 0; i < data.length; ++i) {
                text = "\
                    <tr class=\"tables\">\
                        <td>" + data[i].userId + "</td>\
                        <td>" + data[i].userAccount + "</td>\
                        <td>" + data[i].userName + "</td>\
                        <td>" + data[i].userSexStr + "</td>\
                        <td>" + data[i].userCreatetimeStr + "</td>\
                        <td>" + data[i].userTelephone + "</td>\
                        <td>" + data[i].userMail + "</td>\
                        <td>\
                            <input type=\"button\" value=\"删除\" / onclick=\"del(this)\">\
                            <input type=\"button\" value=\"修改\"/ onclick=\"change(this)\">\
                            <input type=\"button\" value=\"锁定\"/ onclick=\"lock(this)\">\
                            <input type=\"button\" value=\"解锁\"/ onclick=\"unlock(this)\">\
                        </td>\
                    </tr>\
                    "
                $("#mytable").append(text);
            }

        });
    }

    function get_search() {
        get_user_list($("#input")[0].value);
    }
    get_user_list("");
</script>
